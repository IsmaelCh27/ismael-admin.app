<p-card class="h-full">
  <ng-template pTemplate="title">
    <div class="flex justify-between items-center pb-5">
      <h2 class="text-2xl">Im√°genes</h2>
      <div class="">
        <p-button label="Nuevo" icon="pi pi-plus" size="small" styleClass="" (click)="openForm()" />
      </div>
    </div>
  </ng-template>

  <div class="border border-gray-200 rounded-lg pt-1">
    <p-table
      [value]="images()"
      [paginator]="true"
      [rows]="10"
      [tableStyle]="{}"
      [rowsPerPageOptions]="[5, 10, 20]"
      rowHover
    >
      <ng-template #header>
        <tr>
          <th>Nro.</th>
          <th>Imagen</th>
          <th>Nombre</th>
          <th class="text-center!">Es logo</th>
          <th class="text-end! w-10">Acciones</th>
        </tr>
      </ng-template>

      <ng-template #emptymessage>
        <tr>
          @if (isLoading()) {
            <td>
              <p-skeleton width="2rem" />
            </td>
            <td>
              <p-skeleton size="2rem" shape="circle" />
            </td>
            <td>
              <p-skeleton />
            </td>
            <td>
              <p-skeleton />
            </td>
            <td>
              <div class="flex gap-1">
                <p-skeleton />
                <p-skeleton />
              </div>
            </td>
          } @else {
            <td colspan="6" class="text-center!">No hay im registradas.</td>
          }
        </tr>
      </ng-template>

      <ng-template #body let-image let-index="rowIndex">
        <tr>
          <td>{{ index + 1 }}</td>
          <td>
            <img [src]="image.public_url" [style]="{ width: 'auto', height: '23px' }" />
          </td>
          <td>{{ image.name }}</td>
          <td class="text-center!">
            @if (image.is_logo) {
              <p-badge value="Si" severity="success" />
            } @else {
              <p-badge value="No" severity="secondary" />
            }
          </td>
          <td class="py-0!">
            <div class="flex justify-end gap-1">
              <p-button
                icon="pi pi-pencil"
                size="small"
                severity="info"
                pTooltip="Editar"
                tooltipPosition="bottom"
                [outlined]="true"
                (click)="handleClickEdit(image)"
              />
              <p-button
                icon="pi pi-trash"
                size="small"
                severity="danger"
                pTooltip="Eliminar"
                tooltipPosition="bottom"
                [outlined]="true"
                (click)="handleClickDelete($event, image)"
              >
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-card>

<p-confirmdialog [closable]="false">
  <ng-template #footer let-footer>
    <div class="flex justify-end gap-3">
      <p-button
        label="No"
        severity="secondary"
        [outlined]="true"
        [disabled]="isLoading()"
        (click)="rejectDelete()"
      />
      <p-button label="Si" severity="danger" [loading]="isLoading()" (click)="acceptDelete()" />
    </div>
  </ng-template>
</p-confirmdialog>

<p-dialog
  [header]="image().id ? 'Editar Imagen' : 'Registrar Imagen'"
  [modal]="true"
  [(visible)]="formOpen"
  [style]="{ width: '30rem' }"
>
  <div class="flex items-center gap-4 pt-5 px-3">
    <!-- Form -->
    <form
      class="flex flex-col gap-8 leading-7 w-full"
      [formGroup]="validForm"
      (ngSubmit)="onSubmit()"
    >
      <p-fileupload
        class="relative"
        name="myfile[]"
        url="https://www.primefaces.org/cdn/api/upload.php"
        [multiple]="false"
        accept="image/*"
        maxFileSize="1000000"
        (onSelect)="onSelectedFile($event)"
      >
        <ng-template
          #header
          let-files
          let-chooseCallback="chooseCallback"
          let-clearCallback="clearCallback"
        >
          <div class="flex flex-wrap justify-end items-center flex-1 gap-4">
            <div class="flex gap-2">
              <p-button
                (onClick)="choose($event, chooseCallback)"
                icon="pi pi-images"
                [rounded]="true"
              />
              @if (files?.length > 0) {
                <p-button
                  (onClick)="clearCallback()"
                  icon="pi pi-trash"
                  [rounded]="true"
                  severity="danger"
                />
              }
            </div>
          </div>
        </ng-template>

        <ng-template #content let-files>
          <div class="flex flex-col w-full">
            @if (files?.length > 0) {
              <div class="flex justify-center flex-wrap gap-4 w-full">
                @for (file of files; track $index) {
                  <div class="flex flex-col items-center gap-1 w-full">
                    <div class="w-full flex justify-center overflow-hidden">
                      <img
                        role="presentation"
                        [alt]="file.name"
                        [src]="file.objectURL ?? image().public_url"
                        class="max-w-full max-h-[200px]"
                      />
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </ng-template>

        <ng-template #file>
          {{ image().public_url }}
        </ng-template>

        <ng-template #empty>
          @if (image().public_url) {
            <div class="flex flex-col items-center gap-1 w-full">
              <div class="w-full flex justify-center overflow-hidden">
                <img
                  role="presentation"
                  [src]="image().public_url"
                  class="max-w-full max-h-[200px]"
                />
              </div>
            </div>
          } @else {
            <div class="flex items-center justify-center flex-col">
              <div class="border border-surface text-gray-300 rounded-full p-4">
                <lucide-icon [img]="cloudUpload" [strokeWidth]="1" [size]="40"></lucide-icon>
              </div>
              <p class="mt-6 text-sm font-light text-gray-400">Arrastra y suelta aqui tu imagen.</p>
            </div>
          }
        </ng-template>
      </p-fileupload>

      <!-- Nombre -->
      <p-floatlabel>
        <input
          pInputText
          type="text"
          inputId="name"
          formControlName="name"
          [invalid]="validForm.get('name')?.touched && validForm.get('name')?.invalid"
          fluid
        />
        <label for="name">Nombre *</label>
      </p-floatlabel>

      <div class="flex items-center gap-3">
        <p-toggleswitch inputId="is_logo" formControlName="is_logo" />
        <label for="is_logo">Es Logo</label>
      </div>

      <div class="flex justify-end gap-3">
        <p-button
          label="Cancel"
          severity="secondary"
          (click)="closeForm()"
          [disabled]="isLoading()"
        />
        <p-button label="Guardar" icon="pi pi-check" type="submit" [loading]="isLoading()" />
      </div>
    </form>
  </div>
</p-dialog>
